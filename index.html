<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Learn English Through Video</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:Poppins;
    background:linear-gradient(135deg,#fdfbfb,#ebedee);
}
.container{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    padding:10px;
}
.video-box,.subtitle-box{
    flex:1;
    min-width:320px;
}
.subtitle-box{
    background:white;
    border-radius:16px;
    padding:15px;
    max-height:75vh;
    overflow-y:auto;
}
.subtitle-line{
    padding:10px;
    margin-bottom:8px;
    border-radius:12px;
    transition:0.3s;
    cursor:pointer;
}
.subtitle-line.active{
    background:linear-gradient(90deg,#cfd9ff,#e2ebf0);
    font-weight:600;
}
input{
    padding:5px;
    border-radius:6px;
    border:1px solid #ccc;
}
button{
    padding:5px 10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    background:#6c5ce7;
    color:white;
}
.result{
    margin-left:6px;
    font-size:13px;
}
.correct{color:green}
.wrong{color:red}
.summary{
    margin-top:15px;
    padding:10px;
    background:#f1f5ff;
    border-radius:10px;
}
</style>
</head>

<body>

<div class="container">

<!-- VIDEO -->
<div class="video-box">
<iframe id="player" width="100%" height="250"
src="https://www.youtube.com/embed/FjU9qyTZ_OU?enablejsapi=1"
frameborder="0" allowfullscreen></iframe>
</div>

<!-- SUBTITLE -->
<div class="subtitle-box" id="subs"></div>

</div>

<div class="container">
<div class="subtitle-box summary">
    <button onclick="showSummary()">ðŸ“Š Tá»•ng káº¿t</button>
    <p id="summaryResult"></p>
</div>
</div>

<script>
// ================= YOUTUBE API =================
let player;
function onYouTubeIframeAPIReady(){
    player = new YT.Player('player');
}
const tag=document.createElement('script');
tag.src="https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

// ================= LOAD SRT =================
fetch("subtitles.srt")
.then(res=>res.text())
.then(parseSRT);

let subtitles=[];
let results=[];

function parseTime(t){
    const [h,m,s]=t.replace(",",".").split(":");
    return +h*3600 + +m*60 + +s;
}

function parseSRT(data){
    const blocks=data.trim().split(/\n\n+/);
    blocks.forEach(b=>{
        const lines=b.split("\n");
        if(lines.length>=3){
            const time=lines[1].split(" --> ");
            const text=lines.slice(2).join(" ");
            const words=text.split(" ");
            const key=words[Math.floor(words.length/2)];
            subtitles.push({
                start:parseTime(time[0]),
                end:parseTime(time[1]),
                full:text,
                blank:text.replace(key,"____"),
                answer:key.toLowerCase()
            });
            results.push(null);
        }
    });
    renderSubtitles();
}

// ================= RENDER =================
const box=document.getElementById("subs");

function renderSubtitles(){
    subtitles.forEach((s,i)=>{
        const div=document.createElement("div");
        div.className="subtitle-line";
        div.id="line"+i;
        div.innerHTML=`
            <div>${s.blank}</div>
            <input id="input${i}" placeholder="Type word">
            <button onclick="check(${i})">Check</button>
            <span id="res${i}" class="result"></span>
        `;
        div.onclick=()=>player.seekTo(s.start,true);
        box.appendChild(div);
    });
}

// ================= AUTO HIGHLIGHT + SCROLL =================
setInterval(()=>{
    if(!player || !player.getCurrentTime) return;
    const t=player.getCurrentTime();

    subtitles.forEach((s,i)=>{
        const line=document.getElementById("line"+i);
        if(t>=s.start && t<s.end){
            line.classList.add("active");
            line.scrollIntoView({behavior:"smooth",block:"center"});
        }else{
            line.classList.remove("active");
        }
    });
},300);

// ================= CHECK =================
function check(i){
    const input=document.getElementById("input"+i).value.trim().toLowerCase();
    const res=document.getElementById("res"+i);
    if(input===subtitles[i].answer){
        res.textContent="âœ” Correct";
        res.className="result correct";
        results[i]=true;
    }else{
        res.textContent="âœ˜ Wrong";
        res.className="result wrong";
        results[i]=false;
    }
}

// ================= SUMMARY =================
function showSummary(){
    const correct=results.filter(r=>r===true).length;
    document.getElementById("summaryResult")
        .textContent=`Báº¡n lÃ m Ä‘Ãºng ${correct} / ${subtitles.length} cÃ¢u`;
}
</script>

</body>
</html>
